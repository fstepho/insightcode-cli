# ü§ñ AI Development Context

> **For AI Assistants**: This is your primary reference for the InsightCode project. Read this first.

## üìä Quick Status
<!-- GIT-HOOK:START -->
Last Analysis: 2025-07-11 20:41
Score: ? (?/100) | Files: ? | Lines: ?
Top Issues: N/A (complexity: N/A)
<!-- GIT-HOOK:END -->

> ‚ö†Ô∏è **Note**: This score is InsightCode analyzing itself, used for 
> testing and generating examples. This is NOT a quality indicator 
> of InsightCode itself, but a demo of its capabilities.

## üéØ Current Focus
**Active**: v0.6.0 - Major Scoring System Refactor
**Next**: Bug fixes and community feedback integration
**Status**: Major v0.6.0 tasks completed

## üìã v0.6.0 Completed
- ‚úÖ TASK-001: New type definitions with code context and dependency analysis
- ‚úÖ TASK-002: Path normalization with cross-platform support
- ‚úÖ TASK-003: Complete analyzer refactor with progressive scoring curves
- ‚úÖ TASK-004: Enhanced duplication detection with significant code filtering
- ‚úÖ TASK-005: Centralized scoring utilities and thresholds
- ‚úÖ TASK-006: Comprehensive test suite for all scoring metrics
- ‚úÖ TASK-007: Benchmark tool migration and 9 project analysis
- ‚úÖ TASK-008: Removed recommendations engine for client-side flexibility

## üìã Project Context

### Mission
Create a TypeScript quality analyzer that developers actually use.
- **Value Prop**: "TypeScript Quality Score in 30 Seconds - Zero Config, 100% Local"
- **Target**: Growing user base
- **Philosophy**: KISS - If it takes > 1 day, it's too complex

### AI Development Guidelines
When helping with InsightCode:
- **Focus on**: Building features for users (new analyses, better accuracy, CLI improvements)
- **Not on**: Improving our own code metrics (the score is just test data)
- **Example good task**: "Add support for .vue files" or "Implement --watch mode"
- **Example bad task**: "Refactor parser.ts to reduce complexity"

### Constraints
- **Architecture**: Solo maintainer - prefer simple solutions
- **Support**: Must be self-service (docs, not support)
- **Maintenance**: Near-zero maintenance design  
- **Dependencies**: Max 5 NPM dependencies (currently 4)
- **Abstractions**: No DI, no complex patterns
- **Privacy**: 100% local, zero network calls
- **Time**: Maintenance < 1h/week

### Tech Stack
```json
{
  "lang": "TypeScript",
  "cli": "Commander.js",
  "test": "Vitest", 
  "build": "tsc",
  "node": ">=18.0.0"
}
```

## üèóÔ∏è Architecture Map

### Source Code Structure (~1,500 lines total)
```
src/
‚îú‚îÄ‚îÄ cli.ts:51                  # CLI entry point - Commander.js setup
‚îú‚îÄ‚îÄ parser.ts:380              # TypeScript AST parsing - safe recursive traversal ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ analyzer.ts:180            # Core analysis - progressive scoring curves ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ reporter.ts:210            # Terminal output - enhanced with scoring utils ‚≠ê‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ scoring.ts:180             # Scoring functions - research-based thresholds ‚≠ê‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ scoring.utils.ts:95        # Scoring utilities - grading and status ‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ thresholds.constants.ts:45 # Type-safe thresholds and weights ‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ duplication.ts:120         # Enhanced duplication - significant code check ‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ config.ts:125              # Configuration - JSON config file support ‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ dependencyAnalyzer.ts:60   # Dependency graph - incomingCount metrics ‚≠ê‚≠ê
‚îú‚îÄ‚îÄ types.ts:120               # TypeScript types - enhanced interfaces ‚≠ê‚≠ê
‚îú‚îÄ‚îÄ projectInfo.ts:25          # Project info - package.json extraction ‚≠ê
‚îî‚îÄ‚îÄ benchmark.ts:150           # Benchmark tool - 9 project analysis ‚≠ê‚≠ê
```

### Test Structure (~1,800 lines total)
```
tests/
‚îú‚îÄ‚îÄ parser.test.ts             # AST parsing validation with edge cases
‚îú‚îÄ‚îÄ analyzer.test.ts           # Core algorithm tests
‚îú‚îÄ‚îÄ reporter.test.ts           # Reporter output tests
‚îú‚îÄ‚îÄ duplication.test.ts        # Duplication detection tests
‚îú‚îÄ‚îÄ thresholds.constants.test.ts # Thresholds and weights tests
‚îú‚îÄ‚îÄ dependencyAnalyzer.test.ts # Dependency graph tests
‚îú‚îÄ‚îÄ types.test.ts              # TypeScript types validation
‚îú‚îÄ‚îÄ projectInfo.test.ts        # Project info extraction tests
‚îú‚îÄ‚îÄ cli.test.ts                # CLI command tests
‚îú‚îÄ‚îÄ benchmark.test.ts          # Benchmark tool tests
‚îú‚îÄ‚îÄ utils.test.ts              # Utility functions tests
‚îú‚îÄ‚îÄ config.test.ts             # Configuration loading tests
‚îú‚îÄ‚îÄ scoring.utils.test.ts      # Scoring utilities tests
‚îú‚îÄ‚îÄ scoring.test.ts            # Comprehensive scoring metric tests
‚îú‚îÄ‚îÄ integration.test.ts        # End-to-end CLI tests
‚îú‚îÄ‚îÄ utils.test.ts              # Utility function tests
‚îî‚îÄ‚îÄ config.test.ts             # Configuration system tests
```

### Scripts & Tools
```
scripts/
‚îî‚îÄ‚îÄ validate.js                # Validate accuracy against test cases
```

### Dependency Tree (Runtime)
```
insightcode-cli
‚îú‚îÄ‚îÄ commander@13.1.0      # CLI framework
‚îú‚îÄ‚îÄ typescript@5.8.3      # AST parsing
‚îú‚îÄ‚îÄ chalk@4.1.2          # Terminal colors
‚îî‚îÄ‚îÄ fast-glob@3.3.3      # File matching
```

### Data Flow
```
CLI Command ‚Üí cli.ts
    ‚Üì
Load Config ‚Üí config.ts (thresholds from constants)
    ‚Üì
Parse Directory ‚Üí parser.ts
    ‚îú‚îÄ‚îÄ Find Files ‚Üí fast-glob
    ‚îî‚îÄ‚îÄ Parse Each File ‚Üí TypeScript AST (safe traversal)
        ‚îî‚îÄ‚îÄ Extract: complexity, loc, functions, context
    ‚Üì
Analyze ‚Üí analyzer.ts
    ‚îú‚îÄ‚îÄ Dependencies ‚Üí dependencyAnalyzer.ts (incomingCount)
    ‚îú‚îÄ‚îÄ Duplication ‚Üí duplication.ts (significant code only)
    ‚îú‚îÄ‚îÄ Calculate Scores ‚Üí scoring.ts (progressive curves)
    ‚îî‚îÄ‚îÄ Apply Utils ‚Üí scoring.utils.ts (grading, status)
    ‚Üì
Output ‚Üí reporter.ts (terminal with grades) or JSON
```

### Key Algorithms (v0.6.0)
```typescript
// Progressive scoring curves (no artificial caps)
complexityScore = Math.max(0, 100 - (complexity - 5) * 3)
duplicationScore = Math.max(0, 100 - duplicationRatio * 200)
maintainabilityScore = (complexityScore * 0.4) + 
                      (duplicationScore * 0.3) + 
                      (coverageScore * 0.3)

// Enhanced duplication detection
// Filters trivial blocks with isSignificantCode()
// Larger block sizes for meaningful duplicates
// Content normalization improved

// Dependency metrics
incomingCount = files that import this file
percentile = position in dependency distribution
```

### Critical Implementation Points
- **parser.ts:150** - Safe recursive AST traversal
- **analyzer.ts:120** - Progressive scoring implementation
- **scoring.ts:80** - Research-based threshold functions
- **scoring.utils.ts:40** - Grade calculation logic
- **duplication.ts:90** - Significant code filtering
- **thresholds.constants.ts** - Centralized threshold values

## üöÄ Current Metrics
- **Version**: 0.6.0
- **Performance**: ~60,000 lines/second
- **Self-score**: TBD with new scoring system
- **Tests**: ~200 passing (100%)
- **Benchmarks**: 9/9 successful

## üèõÔ∏è Architectural Principles

### Core Design Philosophy
- **DRY (Don't Repeat Yourself)**: Every piece of information exists in exactly ONE place
- **Single Source of Truth**: No duplicate data - calculate don't store when possible
- **KISS (Keep It Simple, Stupid)**: Complexity is the enemy of maintainability
- **Explicit over Implicit**: Clear naming and structure over clever abstractions

### v0.6.0 Breaking Changes Implementation
With v0.6.0, we've implemented our **clarity over compatibility** philosophy:
- ‚úÖ Removed all data redundancy (single source of truth)
- ‚úÖ Consistent ratio/score conventions throughout
- ‚úÖ Explicit property names (durationMs, duplicationRatio)
- ‚úÖ Simplified structure (removed recommendations engine)
- ‚úÖ Research-based thresholds in centralized constants

### Data Structure Principles (v0.6.0+)
```typescript
// ‚ùå BAD: Redundant data
{
  "score": 79,
  "scores": { "overall": 79 }  // Same data in 2 places!
}

// ‚úÖ GOOD: Single location
{
  "scores": { 
    "complexity": 72,
    "overall": 79  // Only here
  }
}

// ‚ùå BAD: Ambiguous units
"duration": 523  // ms? seconds?

// ‚úÖ GOOD: Explicit units
"durationMs": 523  // Clear!

// ‚ùå BAD: Mixed representations
"duplication": 5      // 5%? 5 files? 0.05 ratio?
"coverage": 0.85      // 85% or 0.85%?

// ‚úÖ GOOD: Consistent conventions
"duplicationRatio": 0.05  // Always [0-1] for ratios
"duplicationScore": 85    // Always [0-100] for scores
```

### Naming Conventions
- **Suffixes for clarity**: `complexityScore`, `duplicationRatio`, `overallScore`
- **Standard abbreviations OK**: `loc`, `avg`, `min`, `max`
- **Ambiguous abbreviations NO**: `cfg` ‚Üí `config`, `repo` ‚Üí `repository`
- **Explicit is better**: `incomingCount` not `impact`, `details` not `findings`

### Structure Hierarchy (v0.6.0)
```typescript
{
  "context": {},         // WHO, WHEN, HOW (technical metadata)
  "overview": {},        // WHAT summary (business view) 
  "details": []          // WHAT details (per-file analysis)
  // recommendations removed - client-side concern
}
```
Following the **inverted pyramid principle** - most important first.

## üí° Development Guide

### Quick Commands
```bash
# Development
npm run dev -- analyze      # Self-analysis
npm test                    # Run tests  
npm run benchmark          # Analyze 9 projects

# Git AI Commands
git ai "message"           # Commit with AI context
git ai-status             # Update metrics
git ai-task "new task"    # Add task
git ai-log                # View recent commits

# Release
npm version patch         # Bump version
npm publish              # Publish to NPM
```

### Code Style Philosophy
```typescript
// ‚ùå Bad: Redundant comment
// Increment counter
counter++;

// ‚úÖ Good: Explains WHY
// 50MB buffer prevents ENOBUFS on TypeScript repo
const maxBuffer = 1024 * 1024 * 50;
```

**Self-Documenting Code**:
- Descriptive names > comments
- Explicit > clever
- Structure tells the story

### When Modifying Code
1. Check current metrics with `npm run dev -- analyze`
2. Run `npm test` before changes
3. Use `git ai "message"` for commits  
4. Keep it SIMPLE - no over-engineering
5. Max 5 dependencies (currently at 4)

## üìÖ Session Log
<!-- GIT-LOG:START -->
- 2025-07-11: feat: v0.6.0 - Major scoring system refactor and analysis improvements
- 2025-07-10: Enhance type definitions for better clarity
- 2025-07-10: rename duration to durationMs for clarity in benchmark results
- 2025-07-10: update duplication scoring to use ratio instead of percentage
- 2025-07-10: move benchmark analysis tool for popular JavaScript/TypeScript projects
- 2025-07-10: remove effortHours from issue structure and update related calculations
- 2025-07-10: remove recommendations engine and update analysis structure for client-side calculations
- 2025-07-10: simplify issue structure and enhance descriptions in recommendations
- 2025-07-10: update dependency metrics to use incomingCount and percentile, remove isCriticalPath
- 2025-07-10: update health score calculations and rename duplication property to duplicationRatio
- 2025-07-10: remove health status from analysis overview and related functions
- 2025-07-10: normalize project paths, and enhance tests for path utilities
- 2025-07-10: remove redundant 'unit' property from context in duplication and parser logic
- 2025-07-09: update analysis date, enhance migration specification, and revise removed features for v0.6.0
- 2025-07-09: add normalizePath function for cross-platform file path normalization
- 2025-07-09: enhance type definitions and validation functions for analysis metrics in v0.6.0
- 2025-07-09: update analysis date, enhance documentation, and add project tasks for v0.6.0
- 2025-07-09: update version to 0.5.0 and enhance documentation for rich context extraction features
- 2025-07-09: Introduce rich context extraction for LLM analysis
- 2025-07-08: improve precision of benchmark metrics and reports
- 2025-07-08: correct project analysis path in prepare-commit-msg script
- 2025-07-08: benchmarks on 9 popular project 2025-07-08
- 2025-07-08: Update analysis date in .ai.md, enhance AI development guidelines, and improve commit message context in hook script
- 2025-07-08: Update analysis date in .ai.md, enhance README for clarity, and improve install script comments
- 2025-07-08: Enhance AI system setup and logging; add installation script and checks
- 2025-07-07: Simplified AI documentation system
- 2025-07-03: Recent Enhancements Implementation üöÄ
- 2025-06-28: Benchmark Script Refactor & Enhanced Reporting üìä
- 2025-06-28: Duplication Detection Philosophy Documentation üìñ
- 2025-06-27: Production Code Analysis & Benchmark Fix üéØ
- 2025-06-26: NPM Publication! üéâ
<!-- GIT-LOG:END -->

## üß© Context Injection
```yaml
# Context for AI - we build a tool to analyze code
project: insightcode-cli
type: typescript_quality_analyzer
version: 0.6.0
stage: growth

features:
  - zero_config_analysis
  - configurable_thresholds
  - progressive_scoring_curves
  - research_based_thresholds
  - enhanced_duplication_detection
  - significant_code_filtering
  - safe_ast_traversal
  - production_code_filtering
  - rich_context_extraction_for_llm_analysis
  - 100_percent_local
  - clean_intuitive_json_structure
  - no_data_redundancy
  - centralized_scoring_utilities

constraints:
  - solo_maintainer
  - self_service_only
  - zero_maintenance_goal
  - kiss_principle
  - max_5_dependencies
  - dry_single_source_of_truth
  - clarity_over_compatibility

recent_achievements:
  - v0.6.0_major_refactor_complete
  - progressive_scoring_implemented
  - duplication_algorithm_enhanced
  - test_coverage_expanded
  - benchmark_tool_integrated
  - type_safety_improved

next_milestones:
  - bug_fixes_from_community_feedback
  - vue_react_support
  - incremental_analysis
  - github_action
  - vscode_extension
  - first_contributor
  - technical_content
  - grow_user_base
```

## üìñ Key Documentation
- **User Guide**: `docs/CODE_QUALITY_GUIDE.md` - How to interpret scores
- **Tech Decisions**: `docs/DECISIONS.md` - Why we built it this way  
- **Academic Justification**: `docs/SCORING_THRESHOLDS_JUSTIFICATION.md` - Research-based thresholds
- **Duplication Philosophy**: `docs/DUPLICATION_DETECTION_PHILOSOPHY.md` - Enhanced algorithm explanation
- **Migration Guide**: `docs/MIGRATION_v0.6.0.md` - Breaking changes and migration
- **Changelog**: `CHANGELOG.md` - Version history and breaking changes
- **README**: User-facing documentation
- **Benchmarks**: Analysis of 9 popular projects with new scoring

## üìù Notes
- **For AI**: Always read this file first for current context
- **Updates**: Automatic via git hooks, manual only for focus/milestones
- **Philosophy**: Keep changes minimal, test everything, follow KISS
- **v0.6.0**: Major refactor complete - focus on stability and user feedback

## üéì Technical Foundations
- Progressive scoring curves based on academic research (McCabe, Halstead)
- No artificial caps - extreme values properly penalized
- Enhanced duplication detection with significant code filtering
- Empirical validation with 9 popular projects (674k+ LOC)
- Centralized thresholds for consistency and maintainability
- See `docs/SCORING_THRESHOLDS_JUSTIFICATION.md` for academic basis
- See `docs/DUPLICATION_DETECTION_PHILOSOPHY.md` for algorithm details

---
*Auto-updated by git hooks. Manual updates for milestones only.*