# ü§ñ AI Development Context

> **For AI Assistants**: This is your primary reference for the InsightCode project. Read this first.

## üìä Quick Status
<!-- GIT-HOOK:START -->
Last Analysis: 2025-07-09 01:19
Score: D (61/100) | Files: 12 | Lines: 1450
Top Issues: src/contextExtractor.ts (complexity: 114)
<!-- GIT-HOOK:END -->

> ‚ö†Ô∏è **Note**: This score is InsightCode analyzing itself, used for 
> testing and generating examples. This is NOT a quality indicator 
> of InsightCode itself, but a demo of its capabilities.

## üéØ Current Focus
**Active**: Developing v0.5.0 with rich context extraction for LLM analysis
**Next**: Complete contextExtractor.ts integration and testing
**Blocker**: None

## üìã Project Context

### Mission
Create a TypeScript quality analyzer that developers actually use.
- **Value Prop**: "TypeScript Quality Score in 30 Seconds - Zero Config, 100% Local"
- **Target**: Growing user base
- **Philosophy**: KISS - If it takes > 1 day, it's too complex

### AI Development Guidelines
When helping with InsightCode:
- **Focus on**: Building features for users (new analyses, better accuracy, CLI improvements)
- **Not on**: Improving our own code metrics (the C score is just test data)
- **Example good task**: "Add support for .vue files" or "Implement --watch mode"
- **Example bad task**: "Refactor parser.ts to reduce complexity"

### Constraints
- **Architecture**: Solo maintainer - prefer simple solutions
- **Support**: Must be self-service (docs, not support)
- **Maintenance**: Near-zero maintenance design  
- **Dependencies**: Max 5 NPM dependencies (currently 4)
- **Abstractions**: No DI, no complex patterns
- **Privacy**: 100% local, zero network calls
- **Time**: Maintenance < 1h/week

### Tech Stack
```json
{
  "lang": "TypeScript",
  "cli": "Commander.js",
  "test": "Vitest", 
  "build": "tsc",
  "node": ">=18.0.0"
}
```

## üèóÔ∏è Architecture Map

### Source Code Structure (~1,400 lines total)
```
src/
‚îú‚îÄ‚îÄ cli.ts:51                  # CLI entry point - Commander.js setup
‚îú‚îÄ‚îÄ parser.ts:340              # TypeScript AST parsing - complexity calculation ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ analyzer.ts:151            # Core analysis - criticality-weighted scoring ‚≠ê‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ reporter.ts:187            # Terminal output - colored results with chalk ‚≠ê‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ scoring.ts:152             # Scoring functions - 40/30/30 weight distribution ‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ duplication.ts:100         # Duplication detection - 5-line sliding window ‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ config.ts:125              # Configuration - JSON config file support ‚≠ê‚≠ê‚≠ê
‚îú‚îÄ‚îÄ dependencyAnalyzer.ts:50   # Dependency graph - architectural impact ‚≠ê‚≠ê
‚îú‚îÄ‚îÄ types.ts:89                # TypeScript types - all interfaces ‚≠ê‚≠ê
‚îî‚îÄ‚îÄ projectInfo.ts:25          # Project info - package.json extraction ‚≠ê
```

### Test Structure (~1,479 lines total)
```
tests/
‚îú‚îÄ‚îÄ parser.test.ts             # AST parsing validation
‚îú‚îÄ‚îÄ analyzer.test.ts           # Core algorithm tests
‚îú‚îÄ‚îÄ integration.test.ts        # End-to-end CLI tests
‚îî‚îÄ‚îÄ config.test.ts             # Configuration system tests
```

### Scripts & Tools
```
scripts/
‚îú‚îÄ‚îÄ benchmark.ts               # Analyze 9 popular projects
‚îî‚îÄ‚îÄ validate.js                # Validate accuracy against test cases
```

### Dependency Tree (Runtime)
```
insightcode-cli
‚îú‚îÄ‚îÄ commander@13.1.0      # CLI framework
‚îú‚îÄ‚îÄ typescript@5.8.3      # AST parsing
‚îú‚îÄ‚îÄ chalk@4.1.2          # Terminal colors
‚îî‚îÄ‚îÄ fast-glob@3.3.3      # File matching
```

### Data Flow
```
CLI Command ‚Üí cli.ts
    ‚Üì
Load Config ‚Üí config.ts (thresholds)
    ‚Üì
Parse Directory ‚Üí parser.ts
    ‚îú‚îÄ‚îÄ Find Files ‚Üí fast-glob
    ‚îî‚îÄ‚îÄ Parse Each File ‚Üí TypeScript AST
        ‚îî‚îÄ‚îÄ Extract: complexity, loc, functions
    ‚Üì
Analyze ‚Üí analyzer.ts
    ‚îú‚îÄ‚îÄ Dependencies ‚Üí dependencyAnalyzer.ts (impact scores)
    ‚îú‚îÄ‚îÄ Duplication ‚Üí duplication.ts (5-line blocks)
    ‚îî‚îÄ‚îÄ Calculate Scores ‚Üí scoring.ts (40/30/30 weights)
    ‚Üì
Output ‚Üí reporter.ts (terminal) or JSON
```

### Key Algorithms
```typescript
// Criticality-weighted scoring
criticality = (impact * 2.0) + (complexity * 1.0) + (issues.length * 0.5) + 1
weight = criticality / total_criticality
final_score = Œ£(file_score * weight)

// Duplication detection
// 5-line sliding window, content-based (not structural)
// Normalizes: var/let/const ‚Üí VAR, strings ‚Üí STRING, numbers ‚Üí NUM
// Pragmatic approach: 6% vs SonarQube's 70% on same code
```

### Critical Implementation Points
- **parser.ts:127** - Cyclomatic complexity visitor
- **analyzer.ts:108** - Criticality weighting logic
- **scoring.ts:45** - 40/30/30 weight distribution
- **duplication.ts:73** - Block normalization
- **reporter.ts:156** - Top files ranking

## üöÄ Current Metrics
- **Version**: 0.4.0 (published)
- **Performance**: 62,761 lines/second
- **Self-score**: C (72/100) full, B (82/100) production-only
- **Tests**: 55 passing (100%)
- **Benchmarks**: 9/9 successful

## üí° Development Guide

### Quick Commands
```bash
# Development
npm run dev -- analyze      # Self-analysis
npm test                    # Run tests
npm run benchmark          # Benchmark 9 projects

# Git AI Commands
git ai "message"           # Commit with AI context
git ai-status             # Update metrics
git ai-task "new task"    # Add task
git ai-log                # View recent commits

# Release
npm version patch         # Bump version
npm publish              # Publish to NPM
```

### Code Style Philosophy
```typescript
// ‚ùå Bad: Redundant comment
// Increment counter
counter++;

// ‚úÖ Good: Explains WHY
// 50MB buffer prevents ENOBUFS on TypeScript repo
const maxBuffer = 1024 * 1024 * 50;
```

**Self-Documenting Code**:
- Descriptive names > comments
- Explicit > clever
- Structure tells the story

### When Modifying Code
1. Check current metrics with `npm run dev -- analyze`
2. Run `npm test` before changes
3. Use `git ai "message"` for commits  
4. Keep it SIMPLE - no over-engineering
5. Max 5 dependencies (currently at 4)

## üìÖ Session Log
<!-- GIT-LOG:START -->
- 2025-07-09: Introduce rich context extraction for LLM analysis
- 2025-07-08: improve precision of benchmark metrics and reports
- 2025-07-08: correct project analysis path in prepare-commit-msg script
- 2025-07-08: benchmarks on 9 popular project 2025-07-08
- 2025-07-08: Update analysis date in .ai.md, enhance AI development guidelines, and improve commit message context in hook script
- 2025-07-08: Update analysis date in .ai.md, enhance README for clarity, and improve install script comments
- 2025-07-08: Enhance AI system setup and logging; add installation script and checks
- 2025-07-07: Simplified AI documentation system
- 2025-07-03: Recent Enhancements Implementation üöÄ
- 2025-06-28: Benchmark Script Refactor & Enhanced Reporting üìä
- 2025-06-28: Duplication Detection Philosophy Documentation üìñ
- 2025-06-27: Production Code Analysis & Benchmark Fix üéØ
- 2025-06-26: NPM Publication! üéâ
<!-- GIT-LOG:END -->

## üß© Context Injection
```yaml
# Context for AI - we build a tool to analyze code
project: insightcode-cli
type: typescript_quality_analyzer
version: 0.4.0
stage: growth

features:
  - zero_config_analysis
  - configurable_thresholds
  - criticality_weighted_scoring
  - production_code_filtering
  - rich_context_extraction_for_llm_analysis
  - 100_percent_local

constraints:
  - solo_maintainer
  - self_service_only
  - zero_maintenance_goal
  - kiss_principle
  - max_5_dependencies

next_milestones:
  - complete_context_extractor_integration
  - add_tests_for_v0.5.0_features
  - publish_v0.5.0
  - grow_user_base
  - first_contributor
  - technical_content
  - vue_react_support
  - incremental_analysis
  - github_action
  - vscode_extension
```

## üìñ Key Documentation
- **User Guide**: `docs/CODE_QUALITY_GUIDE.md` - How to interpret scores
- **Tech Decisions**: `docs/DECISIONS.md` - Why we built it this way  
- **Academic Justification**: `docs/SCORING_THRESHOLDS_JUSTIFICATION.md` - Research-based thresholds
- **Duplication Philosophy**: `docs/DUPLICATION_DETECTION_PHILOSOPHY.md` - Why 6% vs 70%
- **Changelog**: `CHANGELOG.md` - Version history and breaking changes
- **README**: User-facing documentation
- **Benchmarks**: `benchmarks/` - Analysis of popular projects

## üìù Notes
- **For AI**: Always read this file first for current context
- **Updates**: Automatic via git hooks, manual only for focus/milestones
- **Philosophy**: Keep changes minimal, test everything, follow KISS

## üéì Technical Foundations
- Thresholds based on academic research (McCabe complexity, Miller's Law)
- Empirical validation with 9 popular projects (674k+ LOC)
- Pragmatic duplication detection: content-based vs structural (6% vs 70%)
- See `docs/SCORING_THRESHOLDS_JUSTIFICATION.md` for academic justification
- See `docs/DUPLICATION_DETECTION_PHILOSOPHY.md` for duplication approach

---
*Auto-updated by git hooks. Manual updates for milestones only.*
